var currentsound=null,searching=!1;const load={open:function(){var e=$("<div>").attr("id","spinner").append($("<img>").attr("src","../logo.gif")),t=$("<div>").attr("id","load-overlay").append(e);$("body").append(t)},close:function(){$("#load-overlay").animate({opacity:0},300,function(){$(this).remove()})}};function resize(){var e=$(window).outerHeight()-$("header").outerHeight()-$("footer").outerHeight();$(".main").css("height",e),$(".main").css("margin-top",$("header").outerHeight())}function openLink(e){window.location=e}function handleOutput(e,t=null){if(load.close(),e.includes("debug:")){e=e.replace("debug:","");console.log("%cDEBUG:\n%c"+e,"color:green","color:white")}else if(e.includes("error:")){var a=e.replace("error:","");console.error(a),null!=t&&1==t.length&&t.text(a)}else if(e.includes("warning:"))console.warn(e);else if(e.includes("direct:")){openLink(e.replace("direct:",""))}else if(e.includes("popup:")){var n=e.replace("popup:","");if("buttons"in(n=JSON.parse(n))){var s=[];$.each(n.buttons,function(e,t){s.push({text:t.text,function:function(){console.log("click lol")}})})}else s=[{text:"Okay",function:function(){closePopUp($(".pop-up"),reload=!0),window.location=""}}];popUp(n.text,s,reload=!0)}}function extractToFormData(e){var t=new FormData;return $.each(e.find("input"),function(e,a){if("file"==$(this).attr("type")){var n=$(this).attr("name");$.each(a.files,function(e,a){t.append(n+"["+e+"]",a)})}else if("checkbox"==$(this).attr("type"))$(this).is(":checked")?t.append($(this).attr("name"),$(this).val()):t.append($(this).attr("name"),"off");else if("radio"==$(this).attr("type")){null!=(a=$("input[name='"+$(this).attr("name")+"']:checked").val())?t.append($(this).attr("name"),a):t.append($(this).attr("name"),"")}else t.append($(this).attr("name"),$(this).val())}),$.each(e.find("select"),function(e,a){t.append($(this).attr("name"),$(this).val())}),$.each(e.find("textarea"),function(e,a){t.append($(this).attr("name"),$(this).val())}),t}function popUp(e,t,a=!1){$(".pop-up").length>0&&$(".pop-up").each(function(e){$(this).remove()});var n=[];$.each(t,function(e,t){n.push($("<button>").text(t.text).on("click",t.function))});var s="pop-up";a&&(s="pop-up reload"),$("body").append($("<div>").attr("class",s).append($("<div>").addClass("pop-up-window").append($("<p>").text(e),$("<div>").addClass("buttons").append(n))))}function closePopUp(e,t=!1){e.hasClass("reload")||t?e.animate({opacity:0},200,function(){e.remove(),window.location=""}):e.animate({opacity:0},200,function(){e.remove()})}function readURL(e,t){if(e.files&&e.files[0]){var a=new FileReader;a.onload=function(e){t.attr("src",e.target.result)},a.readAsDataURL(e.files[0])}}function addAutoResize(){jQuery.each(jQuery("textarea"),function(){var e=this.offsetHeight-this.clientHeight,t=function(t){jQuery(t).css("height","auto").css("height",t.scrollHeight+e)};jQuery(this).on("keyup input",function(){t(this)}).removeAttr("data-autoresize"),t(this)})}$(document).ready(function(){(resize(),$(document).on("click",".track-card",function(e){!function(e){if(!e.hasClass("down")){var t=e.find("a.vote").data("data");$.ajax({type:"post",data:t,url:"../backend/handler/handle-contextmenu.php",success:t=>{e.append(t).addClass("down")}})}}($(this))}),$(document).mouseup(function(e){var t=$(".admin-contextmenu");t.length>0&&(t.is(e.target)||0!==t.has(e.target).length||t.animate({height:0},200,function(){$(this).parent(".track-card").removeClass("down"),$(this).remove()}))}),1==$(".new-votes-popup").length)&&popUp("Du hast heute wieder neue Votes bekommen!",[{text:"Okay",function:function(){closePopUp($(".pop-up"),reload=!1)}}],reload=!1);1==$(".search-bar input[name='search']").length&&1==$(".search-bar select[name='playlist']").length&&("/search"==window.location.pathname&&s($(".search-bar input[name='search']").val(),$(".search-bar select[name='playlist']").val(),!1));function e(e,t){$.ajax({url:"backend/includes/top"+e+".php",method:"POST",data:{time:t},success:function(t){$(".stats#"+e+" .list").html(t)}})}if($(document).on("submit","form",function(e){e.preventDefault(),load.open();var t=$(this).attr("action"),a=$(this).attr("method"),n=$(this).find(".error"),s=extractToFormData($(this));$.ajax({url:t,method:a,dataType:"text",cache:!1,contentType:!1,processData:!1,data:s,success:function(e){handleOutput(e,n)},error:function(){load.close();var e="Es ist ein Fehler aufgetreten";console.error(e),1==n.length&&n.text(e)}})}),$(document).on("click","a.send-data",function(e){if(e.preventDefault(),!$(this).hasClass("disabled"))if($(this).hasClass("sure")){var t=$(this).data("text"),n="Bist du sicher?";void 0!==t&&!1!==t&&(n=t);var s=!1;$(this).hasClass("reload")&&(s=!0),popUp(n,[{text:"Ja",function:function(e){closePopUp($(".pop-up")),load.open();var t=e.attr("href"),n=e.find(".error"),s=e.data("data");null==s&&(s={}),$.ajax({url:t,method:"POST",dataType:"text",data:s,success:function(e){handleOutput(e,n)},error:function(){load.close();var e="Es ist ein Fehler aufgetreten";console.error(e),1==n.length&&n.text(e)}}),e.hasClass("vote")&&a(e)}.bind(null,$(this))},{text:"Nein",function:function(){closePopUp($(".pop-up"))}}],s)}else{load.open();var o=$(this).attr("href"),i=$(this).find(".error"),r=$(this).data("data");null==r&&(r={}),$.ajax({url:o,method:"POST",dataType:"text",data:r,success:function(e){handleOutput(e,i)},error:function(){load.close();var e="Es ist ein Fehler aufgetreten";console.error(e),1==i.length&&i.text(e)}})}}),$(".update-tops").on("change",function(t){e($(this).data("type"),$(this).val())}),$(document).on("click",".stats .follow",function(t){var a=$(this).data("type"),n=$(this).val();if($(this).parents(".stats").is("#tracks"))a="tracks",n=$(this).parents(".stats").find(".head select").val();else a="artists",n=$(this).parents(".stats").find(".head select").val();setTimeout(function(){e(a,n)},500)}),$(document).on("click",".playsong",function(e){e.preventDefault();var t=$(this).data("link");null!=currentsound&&null!=currentsound?currentsound.sound.currentSrc!=t+".ogg"?(currentsound.pause(),(currentsound=new buzz.sound(t,{formats:["ogg","mp3","aac"]})).currentTime=0,currentsound.play()):currentsound.isPaused()?currentsound.play():currentsound.pause():(currentsound=new buzz.sound(t,{formats:["ogg","mp3","aac"]})).play();const a=$(this).hasClass("playing");$(".playsong.playing").removeClass("playing"),a||$(this).addClass("playing"),setTimeout(function(e){e.hasClass("playing")&&e.removeClass("playing")},30100,$(this))}),$(".wrapper").is("#playlist-update"))var t=setInterval(function(){if(null==currentsound||currentsound.isPaused()){const e=window.location.search,t=new URLSearchParams(e).get("g");$.ajax({url:"backend/includes/playlist.php",method:"GET",data:{g:t,updated:!0},success:function(e){if(null==currentsound||currentsound.isPaused()){null!=currentsound&&currentsound.pause();try{var t=(t=$("input[name='&URIS&:']").val()).substring(0,t.length-1),a=e.split("<input type='hidden' name='&URIS&:' value='")[1],s=a.substring(0,a.length-5)}catch(e){window.location=""}t!=s&&($(".wrapper#playlist-update").animate({opacity:0},200,function(){$(this).css("opacity",0).html(e)}),n(function(e){$(".wrapper#playlist-update").animate({opacity:1},300)},200))}}})}},2e3);function a(e){var t=e.siblings("p").text(),a=parseInt($(".votes-left").html());if(e.hasClass("active")){$(".votes-left").html(a<3?a+1:3),e.removeClass("active").removeClass("sure");var n=parseInt(t)-1}else{$(".votes-left").html(a-1),e.addClass("active").addClass("sure");n=parseInt(t)+1}e.siblings("p").text(n)}function n(e,t){var a=0;return function(){var n=this,s=arguments;clearTimeout(a),a=setTimeout(function(){e.apply(n,s)},t||0)}}function s(e,t,a=!0){$.ajax({url:"backend/includes/searchrequest.php",method:"POST",data:{query:e,playlist:t},success:function(e){$(".search-bar").nextAll().remove(),$(e).insertAfter(".search-bar")}}),window.history.replaceState&&(a&&window.history.pushState("search",$(document).find("title").text(),"/search?q="+e+"&p="+t),$("nav .active").removeClass("active"),$("header nav a[href='search']").addClass("active")),$(".search-bar").hasClass("offset")&&$(".search-bar").removeClass("offset")}$(document).on("click",".vote",function(e){$(this).hasClass("disabled")||$(this).hasClass("sure")||a($(this))}),$(".search-bar input[name='search']").on("keyup",n(function(e){s($(this).val(),$(".search-bar select[name='playlist']").val()),clearInterval(t),null!=currentsound&&currentsound.pause()},500)),$(".search-bar select[name='playlist']").on("change",function(e){var a=$(this).val(),n=$(".search-bar input[name='search']").val();null!=currentsound&&currentsound.pause(),"/search"==window.location.pathname?(s(n,a),clearInterval(t)):"/playlist"==window.location.pathname&&(window.history.pushState("playlist",$(document).find("title").text(),"/playlist?g="+a),window.location="")}),$(document).on("click",".open-menu",function(e){if($("header").hasClass("open"))$("header").removeClass("open"),$("nav").animate({top:"-100rem"},function(){$("nav").css("top","").css("display","")});else{$("header").addClass("open");var t=$("header").outerHeight()-1;$("nav").css("top","-100rem").css("display","flex").animate({top:t})}}),$(document).on("mouseup",".pop-up",function(e){var t=$(this).children(".pop-up-window");t.is(e.target)||0!==t.has(e.target).length||closePopUp($(this))})}),$("html").addClass("load"),$(window).on("load",function(e){$("html").removeClass("load")}),$(window).on("resize",function(e){resize()}),$(document).ready(function(){addAutoResize()});